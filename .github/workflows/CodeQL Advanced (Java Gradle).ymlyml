# ëŒ€ë¶€ë¶„ì˜ í”„ë¡œì íŠ¸ì—ì„œ ì´ ì›Œí¬í”Œë¡œìš° íŒŒì¼ì€ ë³€ê²½í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¨ìˆœíˆ ì €ì¥ì†Œì— ì»¤ë°‹í•˜ë©´ ë©ë‹ˆë‹¤.
#
# ë¶„ì„í•  ì–¸ì–´ ì§‘í•©ì„ ì¬ì •ì˜í•˜ê±°ë‚˜, ì‚¬ìš©ì ì •ì˜ ì¿¼ë¦¬ ë˜ëŠ” ë¹Œë“œ ë¡œì§ì„ ì œê³µí•˜ê¸° ìœ„í•´ ì´ íŒŒì¼ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
#
# ******** ì°¸ê³  ********
# ì €ì¥ì†Œì˜ ì–¸ì–´ë¥¼ ê°ì§€í•˜ë ¤ê³  ì‹œë„í–ˆìŠµë‹ˆë‹¤. ì•„ë˜ì— ì •ì˜ëœ `language` ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ í™•ì¸í•˜ì—¬
# ì˜¬ë°”ë¥¸ CodeQL ì§€ì› ì–¸ì–´ ì§‘í•©ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤.
#
name: "CodeQL Advanced (Java Gradle)" # ì›Œí¬í”Œë¡œìš° ì´ë¦„ì„ Java Gradleìš©ìœ¼ë¡œ ëª…í™•íˆ ë³€ê²½

on:
  push:
    branches:
      - "*/working"  
      - "*/main"
  pull_request:
    branches:
      - "*/working"
      - "*/main"
jobs:
  analyze:
    name: Analyze (${{ matrix.language }})
    # ëŸ¬ë„ˆ í¬ê¸°ëŠ” CodeQL ë¶„ì„ ì‹œê°„ì— ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤:
    # - https://gh.io/recommended-hardware-resources-for-running-codeql
    # - https://gh.io/supported-runners-and-hardware-resources
    # - https://gh.io/using-larger-runners (GitHub.comë§Œ í•´ë‹¹)
    # ë¶„ì„ ì‹œê°„ ê°œì„ ì„ ìœ„í•´ ë” í° ëŸ¬ë„ˆ ë˜ëŠ” ë” ë§ì€ ë¦¬ì†ŒìŠ¤ê°€ ìˆëŠ” ë¨¸ì‹  ì‚¬ìš©ì„ ê³ ë ¤í•˜ì‹­ì‹œì˜¤.
    runs-on: ubuntu-latest # Java/Gradle í”„ë¡œì íŠ¸ëŠ” 'ubuntu-latest'ë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤.
    permissions:
      # ëª¨ë“  ì›Œí¬í”Œë¡œìš°ì— í•„ìš”
      security-events: write

      # ë‚´ë¶€ ë˜ëŠ” private CodeQL íŒ©ì„ ê°€ì ¸ì˜¤ëŠ” ë° í•„ìš”
      packages: read

      # private ì €ì¥ì†Œì˜ ì›Œí¬í”Œë¡œìš°ì—ë§Œ í•„ìš”
      actions: read
      contents: read

    strategy:
      fail-fast: false # ë§¤íŠ¸ë¦­ìŠ¤ ì¤‘ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•´ë„ ë‹¤ë¥¸ ë§¤íŠ¸ë¦­ìŠ¤ëŠ” ê³„ì† ì‹¤í–‰
      matrix:
        include:
          # Java Gradle í”„ë¡œì íŠ¸ë¥¼ ë¶„ì„í•˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
          # Kotlinì´ í¬í•¨ëœ ê²½ìš° 'java-kotlin'ìœ¼ë¡œ ìœ ì§€í•˜ê³  ì•„ë˜ 'Build Java project' ìŠ¤í…ì—ì„œ Kotlin ë¹Œë“œ ëª…ë ¹ì–´ ì¶”ê°€
          - language: java      # ìë°”ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ëª…ì‹œ
            build-mode: manual  # Gradle í”„ë¡œì íŠ¸ëŠ” 'manual' ë¹Œë“œ ëª¨ë“œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
            # ì´ë¥¼ í†µí•´ CodeQLì´ ë¹Œë“œ ê³¼ì •ì„ ì •í™•íˆ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

        # CodeQLì€ ë‹¤ìŒ ê°’ì„ 'language' í‚¤ì›Œë“œë¡œ ì§€ì›í•©ë‹ˆë‹¤: 'actions', 'c-cpp', 'csharp', 'go', 'java-kotlin', 'javascript-typescript', 'python', 'ruby', 'rust', 'swift'
        # C, C++ ë˜ëŠ” ë‘˜ ë‹¤ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ë¶„ì„í•˜ë ¤ë©´ `c-cpp`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        # Java, Kotlin ë˜ëŠ” ë‘˜ ë‹¤ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ë¶„ì„í•˜ë ¤ë©´ 'java-kotlin'ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        # JavaScript, TypeScript ë˜ëŠ” ë‘˜ ë‹¤ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ë¶„ì„í•˜ë ¤ë©´ 'javascript-typescript'ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        # ë¶„ì„í•  ì–¸ì–´ ë³€ê²½ ë˜ëŠ” ë¶„ì„ì„ ìœ„í•œ ë¹Œë“œ ëª¨ë“œ ì‚¬ìš©ì ì§€ì •ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ë ¤ë©´,
        # https://docs.github.com/en/code-security/code-scanning/creating-an-advanced-setup-for-code-scanning/customizing-your-advanced-setup-for-code-scanningì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.
        # ì»´íŒŒì¼ëœ ì–¸ì–´ë¥¼ ë¶„ì„í•˜ëŠ” ê²½ìš°, ì½”ë“œë² ì´ìŠ¤ê°€ ë¶„ì„ë˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©ì ì§€ì •í•˜ê¸° ìœ„í•´ í•´ë‹¹ ì–¸ì–´ì˜ 'build-mode'ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        # https://docs.github.com/en/code-security/code-scanning/creating-an-advanced-setup-for-code-scanning/codeql-code-scanning-for-compiled-languagesì„ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # ë ˆí¬ì§€í† ë¦¬ ì½”ë“œë¥¼ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™˜ê²½ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.

      # `github/codeql-action/init` ì•¡ì…˜ì„ ì‹¤í–‰í•˜ê¸° ì „ì— í•„ìš”í•œ ëª¨ë“  ì„¤ì • ë‹¨ê³„ë¥¼ ì¶”ê°€í•˜ì‹­ì‹œì˜¤.
      # ì—¬ê¸°ì—ëŠ” ì»´íŒŒì¼ëŸ¬ ë˜ëŠ” ëŸ°íƒ€ì„ ì„¤ì¹˜(ì˜ˆ: `actions/setup-java`)ì™€ ê°™ì€ ë‹¨ê³„ê°€ í¬í•¨ë©ë‹ˆë‹¤.
      # ì´ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ìˆ˜ë™ ë¹Œë“œì—ë§Œ í•„ìš”í•©ë‹ˆë‹¤.
      - name: Setup Java JDK
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin' # Java ë°°í¬íŒ ì„ íƒ (ì˜ˆ: temurin, zulu, adopt)
          java-version: '17'      # í”„ë¡œì íŠ¸ì— ë§ëŠ” Java ë²„ì „ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš” (ì˜ˆ: '11', '21')
          cache: 'gradle'         # Gradle ìºì‹±ì„ í™œì„±í™”í•˜ì—¬ ë¹Œë“œ ì†ë„ í–¥ìƒ

      # CodeQL ìŠ¤ìº”ì„ ìœ„í•œ CodeQL ë„êµ¬ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: ${{ matrix.language }}
          build-mode: ${{ matrix.build-mode }}
          # ì‚¬ìš©ì ì •ì˜ ì¿¼ë¦¬ë¥¼ ì§€ì •í•˜ë ¤ë©´ ì—¬ê¸°ì— ë˜ëŠ” êµ¬ì„± íŒŒì¼ì— ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          # ê¸°ë³¸ì ìœ¼ë¡œ ì—¬ê¸°ì— ë‚˜ì—´ëœ ì¿¼ë¦¬ëŠ” êµ¬ì„± íŒŒì¼ì— ì§€ì •ëœ ëª¨ë“  ì¿¼ë¦¬ë¥¼ ì¬ì •ì˜í•©ë‹ˆë‹¤.
          # ì´ ì¿¼ë¦¬ì™€ êµ¬ì„± íŒŒì¼ì˜ ì¿¼ë¦¬ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´ ì—¬ê¸°ì— ìˆëŠ” ëª©ë¡ ì•ì— "+"ë¥¼ ë¶™ì´ì‹­ì‹œì˜¤.

          # CodeQLì˜ ì¿¼ë¦¬ íŒ©ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒì„ ì°¸ì¡°: https://docs.github.com/en/code-security/code-scanning/automatically-scanning-your-code-for-vulnerabilities-and-errors/configuring-code-scanning#using-queries-in-ql-packs
          # queries: security-extended,security-and-quality

      # ë¹Œë“œ ë‹¨ê³„ì—ì„œ "ìë™ìœ¼ë¡œ ì½”ë“œë¥¼ ë¹Œë“œí•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤" ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´
      # ìœ„ ë§¤íŠ¸ë¦­ìŠ¤ì—ì„œ í•´ë‹¹ ì–¸ì–´ì˜ ë¹Œë“œ ëª¨ë“œë¥¼ "manual"ë¡œ ì„¤ì •í•˜ì‹­ì‹œì˜¤.
      # ê·¸ëŸ° ë‹¤ìŒ ì´ ë‹¨ê³„ë¥¼ ìˆ˜ì •í•˜ì—¬ ì½”ë“œë¥¼ ë¹Œë“œí•˜ì‹­ì‹œì˜¤.
      # OS ì…¸ì„ ì‚¬ìš©í•˜ì—¬ ì‹¤í–‰í•  ëª…ë ¹ì¤„ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.
      # https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstepsrun ì°¸ì¡°
      - name: Build Java project # ë¹Œë“œ ë‹¨ê³„ë¥¼ ëª…í™•íˆ êµ¬ë¶„
        if: matrix.build-mode == 'manual' # 'manual' ë¹Œë“œ ëª¨ë“œì¼ ë•Œë§Œ ì‹¤í–‰
        shell: bash
        run: |
          echo "Starting Gradle build for CodeQL analysis..."
          # í”„ë¡œì íŠ¸ì˜ ì‹¤ì œ ë¹Œë“œ ëª…ë ¹ì–´ë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”.
          # ì˜ˆë¥¼ ë“¤ì–´, `gradle build`, `gradle clean build`, ë˜ëŠ” íŠ¹ì • íƒœìŠ¤í¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
          # CodeQLì´ ëª¨ë“  ì†ŒìŠ¤ íŒŒì¼ì„ ë³¼ ìˆ˜ ìˆë„ë¡ ì „ì²´ ë¹Œë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.
          ./gradlew build -x test # ğŸ‘ˆ Gradle Wrapperë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œí•˜ê³  í…ŒìŠ¤íŠ¸ ì œì™¸
          
          # ì¤‘ìš”: í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë¹Œë“œë˜ì–´ì•¼ CodeQLì´ ì •í™•í•œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          # ì´ ë¹Œë“œ ëª…ë ¹ì–´ê°€ ë³¸ì¸ì˜ Gradle í”„ë¡œì íŠ¸ì— ë§ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
          echo "Gradle build completed."


      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v3 # CodeQL ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
        with:
          category: "/language:${{matrix.language}}" # ë¶„ì„í•  ì–¸ì–´ ì¹´í…Œê³ ë¦¬ ì§€
